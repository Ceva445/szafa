{% extends "base.html" %}
{% block title %}Dokumenty magazynowe{% endblock %}
{% block page_title %}Dokumenty magazynowe{% endblock %}
{% block page_subtitle %}Lista PZ / DW{% endblock %}
{% block topbar_actions %}
  <a href="{% url 'documents:create_dw' %}" class="btn small">➕ Nowe DW</a>
  <a href="{% url 'documents:create_pz' %}" class="btn small">➕ Nowe PZ</a>
{% endblock %}

{% block content %}
<div class="card">
  <form method="get" class="filter-row" style="align-items:center;">
    <select name="type">
      <option value="">Wszystkie</option>
      <option value="DW" {% if doc_type == "DW" %}selected{% endif %}>DW (wydania)</option>
      <option value="PZ" {% if doc_type == "PZ" %}selected{% endif %}>PZ (przyjęcia)</option>
    </select>

    <input type="text" name="q" placeholder="Szukaj (nr dokumentu / nazwisko / dostawca)" value="{{ q }}">
    <select name="company">
      <option value="">Wszystkie odbiorcy</option>
      {% for c in companies %}
      <option value="{{ c.id }}">{{ c.name }}</option>
      {% endfor %}
    </select>

    <select name="supplier">
      <option value="">Wszyscy dostawcy</option>
      {% for s in suppliers %}
      <option value="{{ s.id }}">{{ s.name }}</option>
      {% endfor %}
    </select>

    <button class="btn primary small">Szukaj</button>
  </form>
</div>

<div class="card">
  <table class="table">
    <thead>
      <tr>
        <th>Nr dokumentu</th>
        <th>Typ</th>
        <th>Data</th>
        <th>Powiązane</th>
        <th>Pozycje</th>
        <th>Akcje</th>
      </tr>
    </thead>
    <tbody>
      {% if doc_type == "DW" %}
        {% for d in documents %}
        <tr>
          <td>{{ d.document_number }}</td>
          <td>DW</td>
          <td>{{ d.issue_date }}</td>
          <td>{{ d.employee.last_name }} {{ d.employee.first_name }}</td>
          <td>{{ d.items.count }}</td>
          <td class="actions">
            <a class="btn small" href="{% url 'documents:detail' d.id 'dw' %}">Szczegóły</a>
            <a class="btn small" href="{% url 'documents:edit' d.id 'dw' %}">✏️</a>
          </td>
        </tr>
        {% empty %}
        <tr><td colspan="6">Brak DW</td></tr>
        {% endfor %}
      {% elif doc_type == "PZ" %}
        {% for d in documents %}
        <tr>
          <td>{{ d.document_number }}</td>
          <td>PZ</td>
          <td>{{ d.issue_date }}</td>
          <td>{{ d.supplier.name }} → {{ d.recipient.name }}</td>
          <td>{{ d.items.count }}</td>
          <td class="actions">
            <a class="btn small" href="{% url 'documents:detail' d.id 'pz' %}">Szczegóły</a>
            <a class="btn small" href="{% url 'documents:edit' d.id 'pz' %}">✏️</a>
          </td>
        </tr>
        {% empty %}
        <tr><td colspan="6">Brak PZ</td></tr>
        {% endfor %}
      {% else %}
        {% for d in documents %}
        <tr>
          <td>{{ d.document_number }}</td>
          <td>{{ d.get_document_type_display }}</td>
          <td>{{ d.issue_date }}</td>
          <td>
            {% if d.document_type == "DW" %}
              {{ d.employee.last_name }} {{ d.employee.first_name }}
            {% else %}
              {{ d.supplier.name }} → {{ d.recipient.name }}
            {% endif %}
          </td>
          <td>{{ d.items.count }}</td>
          <td class="actions">
            {% if d.document_type == "DW" %}
              <a class="btn small" href="{% url 'documents:detail' d.id 'dw' %}">Szczegóły</a>
            {% else %}
              <a class="btn small" href="{% url 'documents:detail' d.id 'pz' %}">Szczegóły</a>
            {% endif %}
          </td>
        </tr>
        {% empty %}
        <tr><td colspan="6">Brak dokumentów</td></tr>
        {% endfor %}
      {% endif %}
    </tbody>
  </table>
</div>
{% endblock %}
