{% extends "base.html" %}
{% block title %}Szczegóły dokumentu {{ doc.document_number }}{% endblock %}
{% block page_title %}Dokument: {{ doc.document_number }}{% endblock %}
{% block page_subtitle %}{% if kind == 'dw' %}Wydanie dla {{ doc.employee }}{% else %}Przyjęcie: {{ doc.supplier }} → {{ doc.recipient }}{% endif %}{% endblock %}
{% block topbar_actions %}
  <a href="{% url 'documents:list' %}" class="btn small">← Powrót</a>
  {% if kind == 'dw' %}
    <a href="{% url 'documents:edit' doc.id 'dw' %}" class="btn small">✏️ Edytuj DW</a>
  {% else %}
    <a href="{% url 'documents:edit' doc.id 'pz' %}" class="btn small">✏️ Edytuj PZ</a>
  {% endif %}
{% endblock %}

{% block content %}
<div class="card">
  <strong>Nr:</strong> {{ doc.document_number }} &nbsp;
  <strong>Data:</strong> {{ doc.issue_date }}<br>
  {% if kind == 'dw' %}
    <strong>Pracownik:</strong> {{ doc.employee }}<br>
  {% else %}
    <strong>Dostawca:</strong> {{ doc.supplier }} <strong>Odbiorca:</strong> {{ doc.recipient }}<br>
  {% endif %}
</div>

<div class="card">
  <h4>Pozycje</h4>
  <table class="table">
    <thead>
      <tr>
        <th>Kod</th><th>Nazwa</th><th>Rozmiar</th><th>Ilość</th><th>Cena</th><th>Wartość</th><th>Uwagi</th><th>Akcje</th>
      </tr>
    </thead>
    <tbody>
      {% for it in items %}
      <tr>
        <td>{{ it.product.code }}</td>
        <td>{{ it.product.name }}</td>
        <td>{{ it.size }}</td>
        <td>{{ it.quantity }}</td>
        <td>{% if it.unit_price %}{{ it.unit_price }}{% else %}-{% endif %}</td>
        <td>{% if it.total_value %}{{ it.total_value }}{% else %}-{% endif %}</td>
        <td>{{ it.notes|default:"" }}</td>
        <td class="actions">
          {% if kind == 'dw' %}
            <a class="btn small" href="{% url 'documents:edit' it.document.id 'dw' %}">✏️</a>

            <form method="post" action="{% url 'documents:item_mark_used' it.id %}" style="display:inline;">
              {% csrf_token %}
              <button class="btn small" onclick="return confirm('Oznaczyć jako zużyte?')">Zużyj</button>
            </form>

            <form method="post" action="{% url 'documents:item_delete' it.id 'dw' %}" style="display:inline;">
              {% csrf_token %}
              <button class="btn small" onclick="return confirm('Usunąć pozycję?')">🗑️</button>
            </form>
          {% else %}
            <form method="post" action="{% url 'documents:item_delete' it.id 'pz' %}" style="display:inline;">
              {% csrf_token %}
              <button class="btn small" onclick="return confirm('Usunąć pozycję?')">🗑️</button>
            </form>
          {% endif %}
        </td>
      </tr>
      {% empty %}
      <tr><td colspan="8">Brak pozycji</td></tr>
      {% endfor %}
    </tbody>
  </table>
</div>
{% endblock %}
